<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
    integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="notes.css">
  <title>Entity Framework Core</title>
</head>

<body class="bg-dark text-light">
  <header>
    <h1 class="display-2 text-center my-4">Entity Framework Core</h1>
    <div class="container">
      <div class="row">
        <div class="col-md-2">
          <div class="dropdown">
            <button class="btn btn-primary btn-block dropdown-toggle" type="button" data-toggle="dropdown">
              Computer Sci.
            </button>
            <div class="dropdown-menu">

              <a class="dropdown-item" href="DotNetDesignPatterns.html" class="dropdown-item">Design
                Patterns</a>
              <a class="dropdown-item" href="studyDesignPatterns.html" class="dropdown-item">Quick Study
              </a>
              <a href="index.html" class="dropdown-item">Notes Home</a>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="dropdown">
            <button class="btn btn-success btn-block dropdown-toggle" type="buton" data-toggle="dropdown">
              C#
            </button>
            <div class="dropdown-menu">
                            <a href="dotNetFundamentals.html" class="dropdown-item">.Net fundamentals</a>
                            <a href="advancedCsharp.html" class="dropdown-item">Advanced c# topics</a>
                            <a class="dropdown-item" href="mvc.html" class="dropdown-item">ASP.net</a>
                            <a href="interviewcSharp.html" class="dropdown-item">C# Interview Topics</a>     
                            <a href="cSharpStudy.html" class="dropdown-item">C# quick-study</a> 
                            <a href="EFC.html" class="dropdown-item">Entity Framework Core</a>  
                            <a href="DotNetCoreAPIs.html" class="dropdown-item">DotNetCore APIs</a>       
                            <a href="index.html" class="dropdown-item">Notes Home</a>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="dropdown">
            <button class="btn btn-danger btn-block dropdown-toggle" type="buton" data-toggle="dropdown">
              JS
            </button>
            <div class="dropdown-menu">
              <a href="JSfundamentals.html" class="dropdown-item">JS Fundamentals</a>
              <a href="advancedJStopics.html" class="dropdown-item">Advanced JS Topics</a>
              <a href="objectOrientedJS.html" class="dropdown-item">Object Oriented in JS</a>              
              <a href="interviewJS.html" class="dropdown-item">JS Interview Related</a>
              <a href="jsDatastructures.html" class="dropdown-item">JS Data Structures</a>
              <a href="strangeJS.html" class="dropdown-item">strange JS</a>
              <a href="JSframeworks.html" class="dropdown-item">JS Frameworks</a>
              <a href="index.html" class="dropdown-item">Notes Home</a>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="dropdown">
            <button class="btn btn-success btn-block dropdown-toggle" type="buton" data-toggle="dropdown">
              Salesforce
            </button>
            <div class="dropdown-menu">
              <a href="index.html" class="dropdown-item">Notes Home</a>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="dropdown">
            <button class="btn btn-warning btn-block dropdown-toggle" type="buton" data-toggle="dropdown">
              WebDevelopment
            </button>
            <div class="dropdown-menu">
                <a href="angular.html" class="dropdown-item">Angular</a>
                <a href="webpack.html" class="dropdown-item">Webpack</a>
              <a href="index.html" class="dropdown-item">Notes Home</a>
            </div>
          </div>
        </div>
        <div class="col-md-2">
          <div class="dropdown">
            <button class="btn btn-primary btn-block dropdown-toggle" type="buton" data-toggle="dropdown">
              Interview Prep
            </button>
            <div class="dropdown-menu">
                <a href="interviewJS.html" class="dropdown-item">JS interview prep</a>
                <a href="interviewcSharp.html" class="dropdown-item">c# interview prep</a>
                <a href="sqlInterviewPrep.html" class="dropdown-item">SQL interview prep</a>
                <a href="index.html" class="dropdown-item">Notes Home</a>
            </div>
          </div>
        </div>

      </div>
    </div>
  </header>

  <div class="container">
    <button class="btn btn-primary d-block mt-25" style="margin-top: 25px" data-toggle="collapse"
      data-target="#collapse-btn-1">API links</button>

    <div class="collapse my-25" id="collapse-btn-1">
      <div class="card">
        <div class="card-body">
          <ul class="list-group">

            <a class="list-group-item list-group-item-dark" target="_blank"
              href="https://medium.com/asos-techblog/maximising-net-core-api-performance-11ad883436c">DotNET core Api Performance</a>

              <a class="list-group-item list-group-item-dark" target="_blank"
              href="https://github.com/benaadams/Ben.BlockingDetector">Blocking Detector</a>

              <a class="list-group-item list-group-item-dark" target="_blank"
              href="https://github.com/App-vNext/Polly">Cancelling redundant tasks</a>

              <a href="https://github.com/KevinDockx/HttpCacheHeaders" target="_blank" class="list-group-item list-group-item-dark">Marvin.Cache.Headers</a>

              	

          </ul>
        </div>
      </div>
    </div>

    <div id="accordion" style="margin-top: 10px">
      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse1" data-parent="#accordion" data-toggle="collapse">
              REST
            </a>
          </h5>
        </div>

        <div id="collapse1" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">REST</h4>

            <p class="card-text bg-primary">REST is architectural style, not standard</p>
            <p class="card-text bg-primary">REST is protocol agnostic</p>
            <p class="card-text">JSON isn't rest, HTTPs isn't even REST</p>


            <p class="card-text bg-primary">CLIENT changes STATE depending upon the representation of the resource you're accessing (from the Server or otherwise)</p>
            <p class="card-text mb-5">and that is REST (Representational State Transfer)</p>

            <ul class="list-group">
                <p class="list-group-item-header">REST is defined by 6 Constraints (constraints can have positive and negative impacts)</p>
                <li class="list-group-item list-group-item-success">1) Uniform Interface --- API and consumers share one single, technical interface: URI, Method (HTTP requests), Media Type (payload aka JSON etc..)</li>
  
                <li class="list-group-item list-group-item-success">2) Client-Server --- client and server are separated (can evolve separately) = server shouldn't be concerned with User-Interface or HOW the client is implemented (we can design our API without any clue of what the client is). </li>
                <li class="list-group-item list-group-item-success">3) Stateless --- state is contained within the request itself (STATE is kept on the client ... not on the server)</li>
                <li class="list-group-item list-group-item-success">4) Layered System --- client cannot tell what layer it's connected to (no layer can access a layer it isn't connected to (next)) - reduces overall complexity</li>
                <li class="list-group-item list-group-item-success">5) Cacheable --- each response message must explicitly state whether it can be cached or not (HTTP cache (holy grail of cacheing)</li>
                <li class="list-group-item list-group-item-success">6) Code on Demand --- (optional) - server can extend client functionality (if client is web app...server can transfer JS code to the client to extend its functionality.</li>
              </ul>

          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse2" data-parent="#accordion" data-toggle="collapse">
              Structuring Outer Facing Contract
            </a>
          </h5>
        </div>

        <div id="collapse2" class="collapse">
          <div class="card-body bg-secondary">


            <p class="card-text bg-primary mb-5">Resource identifiers (the URI where the resources can be found)</p>
            <p class="card-text">each resource has its own URI</p>
            <p class="card-text">Nouns: things, not actions (actions are meant for the HTTP methods)</p>
            <p class="card-text">helps with predictibility</p>
            <p class="card-text">represent hierachy when naming resources - api/authors/{authorId}/books</p>
            <p class="card-text">filters, sorting orders...aren't resources (should be done via Query string) -api/authors?orderBy=name</p>
            <p class="card-text mb-5">api/authors/{authorId}/totalamountofpages</p>

         

            <p class="card-text bg-primary mb-5">HTTP method (POST, PUT, GET)</p>

            <p class="card-text bg-primary mb-5">Payload (representation: media types (application JSON))</p>

            <ul class="list-group">
                <p class="list-group-item-header">Impelementing Outer Facing Contract</p>
                <li class="list-group-item list-group-item-success">1) Create a controller </li>
  
                <li class="list-group-item list-group-item-success">2) Inject a Repository</li>
                <li class="list-group-item list-group-item-success">3) create Action methods</li>
                <li class="list-group-item list-group-item-success">4) Return results</li>
              
            
              </ul>
        


          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse3" data-parent="#accordion" data-toggle="collapse">
              Endpoint Routing
            </a>
          </h5>
        </div>

        <div id="collapse3" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">Endpoint Routing</h4>

            <p class="card-text bg-primary mb-5">Routing matches a request URI to an action on the controller</p>
            <p class="card-text bg-primary">2 Middleware need injected:</p>
            <p class="card-text">app.useRouting() - marks the position in the middleware pipeline where a routing decision is made</p>

            <p class="card-text">app.UseAuthorization()</p>
            <p class="card-text mb-5">app.UseEndpoints() - marks the position in the middleware pipeline where the selected endpoint is executed</p>

            <p class="card-text bg-primary">Convention-based Routing (typically used for Web Applications)</p>

            <p class="card-text mb-5">app.UseEndpoints(endpoints => { endpoints.MapControllerRoute(name: "default", pattern: "{controller=home}/{action=Index}/{id?}"; endpoints.MapRazorPages()});</p>

            <p class="card-text bg-primary">Attribute-based Routing (typically used for APIs)</p>

            <p class="card-text">app.useEndpoints(endpoints => { endpoints.MapControllers();});</p>
            <p class="card-text">No conventions are applied ... so use attributes.  Use attributes at controller and action level: [Route], [HttpGet]...</p>
            <p class="card-text"><strong>Http Cache</strong> Relies on correct use of Http methods</p>


          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse4" data-parent="#accordion" data-toggle="collapse">
                Status Codes
            </a>
          </h5>
        </div>

        <div id="collapse4" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">Importance of Status Codes</h4>

            <p class="card-text bg-primary mb-5">Status codes should describe the results of the Resource OUTER FACING layer of the API (not concerned with levels lower than it)</p>

            <p class="card-text bg-primary">5 levels:</p>

            <ul class="list-group bg-dark">

              <li class="list-group-item list-group-item-info">
                 1) Level 100 not used by APIs
                  </li>
              <li class="list-group-item list-group-item-info">2) Level 200 - success level 201 success creation of resource and Level 204 - Success No Content</li>
              <li class="list-group-item list-group-item-info">3) level 400 Client Mistakes</li>
              <li class="list-group-item list-group-item-info">3) level 400 - Bad Request</li>
              <li class="list-group-item list-group-item-info">3) level 401 - Unathorized</li>
                <li class="list-group-item list-group-item-info">3) level 403 - Authorization succeeded but not authorized</li>
                <li class="list-group-item list-group-item-info">3) level 404 - Not Found</li>
                <li class="list-group-item list-group-item-info">3) Level 405 - Method Not Allowed (Post when only Get is implemented)</li>
                <li class="list-group-item list-group-item-info">3) Level 406 - Not acceptable (consumer requested a presentation not supported by the API)...requesting XML while API only returns JSON</li>
                <li class="list-group-item list-group-item-info">3) level 409 - Conflict with the request (trying to create a resource that already exists ... Concurrency issues)</li>
                <li class="list-group-item list-group-item-info">3) Level 415 - Unsupported media type</li>
                <li class="list-group-item list-group-item-info">3) level 422 - Unprocessable entity (server understands the request so 415 not appropriate) - semantic mistakes ... (validation rules)</li>
                <li class="list-group-item list-group-item-info">4) level 500 - server mistakes</li>
                <li class="list-group-item list-group-item-info">4) level 500 - Internal Server error</li>
             
            </ul>

            <p class="card-text bg-primary mb-5"><strong>Errors</strong> = Consumer passes invalid data to the API and the API correctly rejects it (level 400 codes).  Do not contribute to API availability</p>

            <p class="card-text bg-primary mb-5"><strong>Faults</strong> = API fails to return a response to a valid request made by the consumer (level 500 status codes).  DO contribute to the overall API availability</p>

          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse5" data-parent="#accordion" data-toggle="collapse">
              Below Outer Facing Model
            </a>
          </h5>
        </div>

        <div id="collapse5" class="collapse">
          <div class="card-body bg-secondary">          
            <h4 class="card-title">Below Outer Facing Model</h4>

            <p class="card-text bg-primary mb-5">Entity Model represents database rows as Objects
            </p>

            <p class="card-text bg-primary mb-5">Whenever mapping fields from one class to another ... try using Automapper (better to use AutoMapper.Extensions.Microsoft.DependencyInjection)</p>

            <p class="card-text">need to Configure Services in Startup.cs for it --- services.AddAutoMapper(AppDomain.CurrentDomain.GetAssemblies());</p>


            <p class="card-text bg-primary"><strong>Handling Faults</strong></p>

            <p class="card-text">try catches aren't expensive on their own...but once an exception IS THROWN ... it becomes detriment to performance.</p>

            <p class="card-text">check Configure method in Startup.cs</p>

            <p class="card-text bg-primary">handling HEAD</p>

            <p class="card-text bg-info">HEAD is identical to GET, with the notable difference that the API shouldn't return a response Body (can be used to obtain info on the response...whether the resource is still valid, accessible at all etc...)</p>

            <p class="card-text bg-info">can just do the following (on same method)</p>

            <p class="card-text">[HttpGet()]</p>
            <p class="card-text">[HttpHead]</p>

    

          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse6" data-parent="#accordion" data-toggle="collapse">
                Passing Data to the API
            </a>
          </h5>
        </div>

        <div id="collapse6" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">Passing Data to the API</h4>


            <p class="card-text bg-primary">via request body
            </p>
            <p class="card-text bg-primary">via url query strings
            </p>

            <p class="card-text">by default ASP.NET Core attempts to use the complex object model binder</p>

            <p class="card-text bg-primary mb-5">Filtering --- allows you to be precise by adding filters until you get exactly the results you want</p>

            <p class="card-text bg-primary mb-5">Searching --- allows you to go wider ... you don't know exactly which items will be in the collection</p>

            <p class="card-text bg-info">Filtering and Search options are not part of the resource ... only allow filtering on fields that are part of the resource.</p>

            <p class="card-text bg-success mb-5">var collection = _context.Authors as IQueryable(Author);  (turn a table into a Queryable collection)</p>

            <p class="card-text bg-primary"><strong>Deferred Execution</strong></p>

            <p class="card-text">Query execution occurs sometime after the query is constructed</p>

            <p class="card-text bg-info">A query variable stores query commands, not results</p>
            <p class="card-text">IQueryable(T) creates an expression tree</p>
            <p class="card-text">Execution is deferred until the query is iterated over</p>
            <p class="card-text">foreach loop</p>
            <p class="card-text">ToList(), ToArray(), ToDictionary(); Singleton queries (First, Last, etc...)</p>

            <p class="card-text bg-warning">Shouldn't allow POST with url containing the id ...  (Framework handles this for us returning a 405 method not found)</p>




          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse7" data-parent="#accordion" data-toggle="collapse">
              Method Safety and Method idempotency
            </a>
          </h5>
        </div>

        <div id="collapse7" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">Method Safety and Method idempotency</h4>


            <p class="card-text bg-primary">a method is considered safe when it doesn't change the resource representation</p>

            <p class="card-text bg-primary mb-5">a method is considered idempotent when it can be called multiple times with the same result</p>

            <p class="card-text bg-success">GET = both</p>

            <p class="card-text bg-success">Options and head = Both</p>

            <p class="card-text bg-success">Post = neither of them
            </p>

            <p class="card-text bg-success">DELETE = not safe BUT it's idempotent</p>

            <p class="card-text bg-primary">For a collection of Resources...just create a new Resource Type --> create a new Controller</p>


          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse8" data-parent="#accordion" data-toggle="collapse">
              Validation
            </a>
          </h5>
        </div>

        <div id="collapse8" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">Validation, Options, Updating Resources</h4>

            <p class="card-text bg-primary">Supporting Options</p>

            <p class="card-text">handles communication about how to speak to our API</p>

            <p class="card-text bg-primary mb-5">[HttpOptions]</p>

            <p class="card-text bg-primary">Validation</p>


            <p class="card-text bg-info">Validate input, not output (validate input with DataAnnotations)
            </p>

            <p class="card-text bg-info">Class-level input-validation with IValidatableObject</p>

            <p class="card-text bg-primary">Checking Validation Rules</p>
            <p class="card-text">Built in ModelState is used</p>

            <p class="card-text bg-primary">Reporting Validation errors</p>

            <p class="card-text">Response status should be 422 (client level error)</p>

            <p class="card-text bg-info mb-5">When a controller is annatated with ApiController attribute it will automatically return a 400 BadRequest on validation errors</p>

            <p class="card-text bg-primary">Updating Resources</p>

            <p class="card-text"><strong>PUT</strong> for full updates</p>

            <p class="card-text">all resource fields are either overwritten or set to their default values</p>

            <p class="card-text bg-primary"><strong>PATCH</strong> for partial updates</p>

            <p class="card-text">allows sending over change sets via JsonPatchDocument</p>

            <p class="card-text bg-primary mb-5"><strong>UPSERTING</strong> create a resource with PUT or PATCH</p>

            <p class="card-text bg-primary"><strong>Updating Collection Resources</strong></p>

            <p class="card-text bg-primary">Upserting</p>

            <p class="card-text">PUT = ideompotent</p>

            <p class="card-text bg-primary">Partially updating a Resource</p>

            <p class="card-text bg-primary"><strong>Patch</strong></p>

            <p class="card-text bg-info">(Http PATCH is for partial updates)</p>

            <p class="card-text bg-info">preferred over PUT because of performance reasons</p>

            <p class="card-text bg-info">return type for PATCH should be sent with media type "application/json-patch+json"</p>

            <ul class="list-group">
                <p class="list-group-item-header">6 possible JSON Patch Operations</p>
                <li class="list-group-item list-group-item-info">Add { "op": "add", }</li>
                <li class="list-group-item list-group-item-info">Remove { "op"; "remove" }</li>
                <li class="list-group-item list-group-item-info">Replace { "op"; "replace" }</li>
                <li class="list-group-item list-group-item-info">Copy { "op"; "copy" }</li>
                <li class="list-group-item list-group-item-info">Move { "op": "move" }</li>
                <li class="list-group-item list-group-item-info">Test { "op": "test" }</li>
              
              </ul>


          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse9" data-parent="#accordion" data-toggle="collapse">
              Repository Pattern
            </a>
          </h5>
        </div>

        <div id="collapse9" class="collapse">
          <div class="card-body bg-secondary">
            <h4 class="card-title">Repository Pattern</h4>

            <p class="card-text bg-primary">an abstraction that reduces complexity and aims to make the code safe for the repository impelentation, persistance ignorant </p>

            <ul class="list-group">
                <p class="list-group-item-header">Advantages:</p>
                <li class="list-group-item list-group-item-info">Less Code duplication</li>
                <li class="list-group-item list-group-item-info">less error-prone</li>
                <li class="list-group-item list-group-item-info">Testing (if controller contains PERSISTANCE ...it's harder to pinpoint what may be going wrong)</li>
              
              </ul>

              <p class="card-text bg-primary">Persistance ignorant</p>

              <p class="card-text">switching out the persistance technology is not the main purpose... Choosing the best one for each repository method is.</p>

              <p class="card-text">we're working on a contract, not an implementation (in regards to having blank method body in repository)</p>

              <p class="card-text">always have a set of methods matching the required functionality and call them, even if they don't do anything in the current implementation.</p>

              <ul class="list-group">
                <p class="list-group-item-header">Implementation:</p>
                <li class="list-group-item list-group-item-success">RepositoryClass "LibraryRepository" inherits from IRepositoryClass</li>
                <li class="list-group-item list-group-item-success">RepositoryClass accesses the dbContext via Dependency Injection to class constructor </li>
                <li class="list-group-item list-group-item-success">IRepositoryClass outlines methods that RepositoryClass will implement (no access to dbContext in the IRepoClass)</li>
                <li class="list-group-item list-group-item-success">Both the RepositoryClass and IRepositoryClass belong in Services folder</li>
              
              </ul>


             
          </div>
        </div>
      </div>



      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse10" data-parent="#accordion" data-toggle="collapse">
              Building in Development Mode Visual Studio 2019
            </a>
          </h5>
        </div>

        <div id="collapse10" class="collapse">
          <div class="card-body bg-secondary">


            <ul class="list-group">
              <p class="list-group-item-header">Steps for building in Development Mode (will make everything pop up / log in a console window)</p>
              <li class="list-group-item list-group-item-success">Properties => Launch to Project (from IIS)</li>

              <li class="list-group-item list-group-item-success">Uncheck "Launch Browser" (makes everythign pop up in console window)</li>
              <li class="list-group-item list-group-item-success">App URL: http://localhost:51044  (the URL all your Postman requests / tests will refer to)</li>
            </ul>

            
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse11" data-parent="#accordion" data-toggle="collapse">
              API project structure
            </a>
          </h5>
        </div>

        <div id="collapse11" class="collapse">
          <div class="card-body bg-secondary">
           
            <p class="card-text bg-primary">Resource Parameters</p>
            <p class="card-text bg-info">create class "AuthorsResourceParameters" inside separate folder</p>
            <p class="card-text bg-info">this allows us to just pass this in as a method parameter inside controller </p>
            <p class="card-text bg-info mb-5">Useful because ... IF we decide to add more parameters...we can just add the parameters in one spot (the class body)</p>

            <p class="card-text bg-primary mb-5"><strong>Repository Pattern</strong> (see above)</p>

            <p class="card-text bg-primary">Profiles (related to AutoMapper)</p>

            <p class="card-text">Crate a Profiles folder and then a ClassProfile for each class you will be saving into database</p>

            <p class="card-text">ClassProfile : Profile (using AutoMapper)</p>

            <img src="img/BookProfile.PNG" alt="Book Profile mapping" class="card-img img-fluid my-5">
            <img src="img/AuthorsProfile.PNG" alt="Author Profile mapping" class="card-img img-fluid my-5">

            <p class="card-text bg-primary mb-5"><strong>Entities folder</strong> contains classes that will persist in data store</p>

            <p class="card-text bg-primary mb-5"><strong>Model folder</strong> contains Dto classes (used for mapping and returning from our Controller methods so that we don't have to return entire Entity)</p>

            <img src="img/BookDto.png" alt="Book Dto for mapping" class="card-img img-fluid my-5">


            <ul class="list-group">
                <p class="list-group-item-header">possible Nuget Packages:</p>

                <li class="list-group-item list-group-item-success">AutoMapper.Extensions.Microsoft.DependencyInjection</li>
                <li class="list-group-item list-group-item-success">Microsoft.AspNetCore.JsonPatch</li>
                <li class="list-group-item list-group-item-success">Microsoft.AspnetCore.Mvc.NewtonsoftJson</li>
                <li class="list-group-item list-group-item-success">Microsoft.EntityFrameworkCore</li>
                <li class="list-group-item list-group-item-success">Microsoft.EntityFrameworkCore.SqlServer</li>
                <li class="list-group-item list-group-item-success">Microsoft.EntityFrameworkCore.Tools</li>
              </ul>

              
            
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse12" data-parent="#accordion" data-toggle="collapse">
              Paging
            </a>
          </h5>
        </div>

        <div id="collapse12" class="collapse">
          <div class="card-body bg-secondary">
           
            <p class="card-text bg-primary">cacheable Constraint = Each response message must explicitly state if it can be cached or not</p>

            <p class="card-text bg-primary">considered best-practice to implement paging on each collection ... or at least on those Resources that can also be created?  Parameters for paging passed through via the query string.  Users should be able to specify the page # and page size ( page size should be limited).  IF no parameters ...just return the first page by default.  PAGING should go all the way through to the data store ... IE don't wait to Page the data in the controller .... do it in database</p>

            <p class="card-text bg-info mb-5">Deferred Execution helps with this = Query variable itself never holds the query results themselves ... Query execution occurs sometime after the query is constructed  (use IQueryable<T>).    Should see OFFSET in API result in console window or something blah blah which demonstrates that paging is @ work</p>
                   

            <img src="img/queryingPaginationRepositoryMethod.PNG" alt="QueryingPagination Repository method" class="card-img img-fluid my-5">

            <p class="card-text bg-primary">Returning MetaData = think about returning links to the previous and next pages ... can include additional information (total count, amount of pages, etc...)</p>
            
            <p class="card-text bg-info">Use a custom header, like X-Pagination on the reponse</p>
            
            <p class="card-text bg-info">for returning pagination collections = created a Custom PagedList<T> class</T></p>

            <img src="img/iPropertyMappingService.PNG" alt="IpropertyMappingService" class="card-img img-fluid mt-5"></img>

            <img src="img/propertyMappingService.PNG" alt="Property Mapping Service" class="card-img img-fluid mt-5">

            <img src="img/propertyMappingService2.PNG" alt="QueryingPagination Repository method" class="card-img img-fluid mb-5">

            <p class="card-text bg-info">Allowing sorting on resource fields, not on fields that lie beneath that layer</p>

            <p class="card-text bg-info">Return the OrderBy clause as query string in pagination links</p>


            <img src="img/apiIQueryableExtensions.PNG" alt="IQueryableExtensions" class="card-img img-fluid mt-5">

            <img src="img/apiIQueryableExtensions2.PNG" alt="IQueryableExtensions2" class="card-img img-fluid mb-5">

            <p class="card-text bg-primary"><strong>Data Shaping</strong></p>
            
            <img src="img/apiIEnumerableExtensions.PNG " alt="IEnumerableExtensions" class="card-img img-fluid mt-5">

            <img src="img/apiIEnumerableExtensions2.PNG" alt="apiIEnumerableExtensions2" class="card-img img-fluid mb-5">
            
            <p class="card-text bg-info">ExpandoObject = Object whose members can be dynamically added or removed at RunTime</p>
            
            <p class="card-text bg-info">Data shaping allows consumer of the API to choose the resource fields (instead of returning all the fields of the Author for example) fields =id, name  (shape on fields of the resource, not on the fields of lower-level layer objects)</p>
            
            <p class="card-text bg-warning">Dynamically creating an object from our ObjectDtos (at RunTime) to return in responses</p>
            

          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse13" data-parent="#accordion" data-toggle="collapse">
              API Performance
            </a>
          </h5>
        </div>

        <div id="collapse13" class="collapse">
          <div class="card-body bg-secondary">
           
            <p class="card-text bg-primary">thread pool starvation (common cause of slow, bottlenecked code) -- where your thread pool is too busy exhausted and is unavailable to jump around and pick up new requests</p>

            <ul class="list-group">
              <p class="list-group-item-header">Possible issues:</p>
              <li class="list-group-item list-group-item-success">Redis caching through StackExchange --> <strong>Redis bulk data management</strong></li>

              <li class="list-group-item list-group-item-success">ConnectionMultiplexer.Connect(Connection) --> <strong>ConnectionMultiplexer.ConnectAsync(Connection)</strong></li>
              
            </ul>

         

              <p class="card-text bg-primary mt-5"><strong>Redis bulk data management</strong></p>

              <img src="img/redisBulk.PNG" alt="Redis Bulk data" class="card-img img-fluid my-5">

              <p class="card-text bg-primary"><strong>Logging Output</strong></p>

              <p class="card-text bg-info">Serilog Library -- Console Standard Out (console output was slow)</p>

              <img src="img/apiLoggingOutput.PNG" alt="Redis Bulk data" class="card-img img-fluid my-5">

              <p class="card-text bg-primary"><strong>Cancelling redundant tasks</strong> -- Polly</p>

              <p class="card-text bg-info">Polly -- helps you easily control tasks such as timeouts, retrying failed code, and some other powerful functionality</p>

              <ul class="list-group">
                <p class="list-group-item-header">Polly settings:</p>

                <li class="list-group-item list-group-item-success">Timeout after 30 seconds</li>
  
                <li class="list-group-item list-group-item-success">Retry three times if the request fails (this can include failing due to the timeout)</li>
                
                <li class="list-group-item list-group-item-success">If it failed after three times, throw an exception back to our application so that we can return an error on our API response</li>

                <li class="list-group-item list-group-item-success">about connections: Waiting forever (having no timeout) is a bad design strategy: it specifically leads to the blocking up of threads or connections (itself often a cause of further failure)</li>

                <li class="list-group-item list-group-item-success">Async calls must be used wherever possible to avoid thread pool starvation</li>

                <li class="list-group-item list-group-item-success">As for long-running dependency calls, we now know that we need to provide cancellation support where appropriate, with the implemenation in place of timing out and cancelling those tokens.</li>

              </ul>

          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse14" data-parent="#accordion" data-toggle="collapse">
              Cacheable
            </a>
          </h5>
        </div>

        <div id="collapse14" class="collapse">
          <div class="card-body bg-secondary">
           
            <p class="card-text bg-primary">HTTP cache (holy Grail)</p>

            <p class="card-text bg-primary">response caching middleware</p>

            <p class="card-text bg-primary">every response should define itself as cacheable or not</p>

            <p class="card-text bg-primary">cache is separate component that sits between the client (user) and the API itself</p>
           
            <p class="card-text bg-info">Receives repsonses from the API and stores them if they are deemed cacheable</p>

            <p class="card-text bg-info">Accepts requests from consumer to the API</p>

            <p class="card-text bg-info mb-5">It's the middle-man of request-response communication</p>

           
            <ul class="list-group">
              <p class="list-group-item-header">3 Cache Types:</p>
              <li class="list-group-item list-group-item-success">Client Cache ... Lives on the client (private cache), cache on your mobile device ... cache on LocalStorage (Angular)</li>

              <li class="list-group-item list-group-item-success">Gateway Cache ... Lives on the server (shared)</li>
              <li class="list-group-item list-group-item-success">Proxy Cache ... Lives on the network (shared cache) ... (used by corporations to serve thousands)</li>
            </ul>

            <p class="card-text bg-primary my-5">Reponse Cache Attribute and Middleware</p>

            <p class="card-text bg-info">state for each resource whether or not it's cacheable</p>

            <p class="card-text bg-info">Cache-Control: max-age=120 (says it's cacheable only for 120 seconds)</p>

            <p class="card-text bg-info">doesn't actually cache anything ... (need a cache store)</p>

            <p class="card-text bg-warning mb-5">Postman by default sends a no-cache request (go into settings and turn off "send-no-cache header"</p>

            <p class="card-text bg-primary">ResponseCaching Middleware</p>

            <p class="card-text bg-info">services.AddResponseCaching(); inside Startup.cs</p>

            <p class="card-text bg-info">app.UseResponseCaching();  inside Startup.cs in Configure method (make sure it's before all the other app.Use ones)</p>

            <img src="img/apiStartupCS.PNG" alt="caching Startup.cs" class="card-img img-fluid mt-5">
            
            <img src="img/apiStartupCS2.PNG" alt="caching Startup.cs 2" class="card-img img-fluid">

            <img src="img/apiStartupCS3.PNG" alt="caching Startup.cs 3" class="card-img img-fluid mb-5">


            <p class="card-text bg-primary">Cache Profiles -- add into services.AddControllers() in Startup.cs</p>

            <ul class="list-group">
                <p class="list-group-item-header">Expiration Model</p>
                <li class="list-group-item list-group-item-success">Allows the server to state how long a response is considered fresh</li>
  
                <li class="list-group-item list-group-item-success">Expires Header HAS been superceded by Cache-Control header</li>
                <li class="list-group-item list-group-item-success">Cache-Control header</li>
                <li class="list-group-item list-group-item-primary"><strong>Private Cache</strong> + Reduces bandwidth requirements ++ Less Requests from cache to API</li>
                <li class="list-group-item list-group-item-primary"><strong>Shared Cache</strong> + Doesn't save bandwidth between cache and API ++ Drastically lowers requests to the API</li>
              </ul>

              <ul class="list-group">
                <p class="list-group-item-header">Validation Model (not supported by DOTnet core middleware)</p>
                <li class="list-group-item list-group-item-success">Used to validate the freshness of a response that's been cached</li>
                <li class="list-group-item list-group-item-primary"><strong>Strong Validators:</strong> + Change if the body or headers of a response change ++ use ETag (Entity Tag) response headers ETag: "12345" +++ Can be used for concurrency checks too (when updating resources)</li>
                <li class="list-group-item list-group-item-primary"><strong>Weak Validators:</strong> + Doesn't always change when response changes (up to server)  last modified: (example ... weak because 1 second gap)  ETag: "w/12345" (weak example)</li>
                <li class="list-group-item list-group-item-info">use weak when you DON'T necessarily need the most recent version  ( a Resource we can GET as well as UPDATE = bad use of weak)</li>
                <li class="list-group-item list-group-item-primary"><strong>Private cache (client side)</strong> + Reduces bandwidth requirements</li>
                <li class="list-group-item list-group-item-primary"><strong>Shared (public)</strong> Saves bandwidth between cache (middleware between client and API) and API (Api doesn't have to recreate the response)</li>
              </ul>

              <p class="card-text bg-primary my-5">Expiration and Validation Models are usually combined</p>

              <p class="card-text bg-primary"><strong>Private cache</strong></p>

              <p class="card-text bg-info">As long as the response hasn't expired (Isn't stale), thate response can be returned from the cache</p>

              <p class="card-text bg-info">Reduces communication with the API (including response generation), reduces bandwidth requirements</p>

              <p class="card-text bg-info mb-5">If it has expired, the API is hit</p>


              <p class="card-text bg-primary"><strong>Public Cache</strong></p>

              <p class="card-text bg-info">As long as the response hasn't expired (isn't stale) that response can be returned from the cache</p>

              <p class="card-text bg-info">Reduces bandwidth requirements between cache and API, dramatically reduces request to the API</p>

              <p class="card-text bg-info">If it has expired, the API is hit</p>

              <p class="card-text bg-info mb-5">Bandwidth between cache and API and response generation is potentially reduced</p>

              <p class="card-text bg-primary">Cache-Control Directives</p>

              <p class="card-text bg-info">Response:</p>

              <p class="card-text bg-success">Freshness (max-age, s-maxage) ... can set different for private / public</p>

              <p class="card-text bg-success">Cache Type (public, private)</p>

              <p class="card-text bg-success">Validation (no-cache, must-reavalidate, proxy-reavalidate)</p>

              <p class="card-text bg-success mb-5">other (no-store, no-transform) no-store = for confidentiality reasons</p>
              
              <p class="card-text bg-info">Request (by Client):</p>

              <p class="card-text bg-success">Freshness (max-age, min-fresh, max-stale)</p>

              <p class="card-text bg-success">Validation (no-cache)</p>

              <p class="card-text bg-success">Other (no-store, no-transform, only-if-cached)</p>

              <p class="card-text bg-primary my-5">Supporting <strong>Http Cache</strong></p>

             
              <p class="card-text bg-warning">ETags are preferred over dates as they are strong validators</p>
              
              <p class="card-text bg-primary">Marvin.Cache.Headers (useful Header middleware from tutorial)</p>
          
              <p class="card-text bg-info">IF a response is stale, a cache must validate it using ETags</p>

              <p class="card-text bg-warning">MSFT Response cache good for simple use cases ... like Expiration ... ONCE VALIDATION comes into play ... (Add in Marvin.Cache middleware)</p>

              <p class="card-text bg-primary"><strong>Cache Stores and CDNs</strong></p>

              <p class="card-text bg-info">most cache stores are full-blown cache servers, not pieces of middleware</p>

              <p class="card-text bg-info">private caches LIVE on the CLIENT</p>

              <p class="card-text bg-info">Xamarin ... probably needs CacheCow.Client</p>

              <p class="card-text bg-info">Shared Caches = gateway or proxy caches</p>

              <p class="card-text bg-info">Varnish, Apache Traffic Server, Squid</p>

              <p class="card-text bg-primary mt-5">CDNs</p>

              <p class="card-text bg-info">extensively use caching: Http cache (Azure CDN, Cloudfare, Akamai)</p>

              <p class="card-text bg-warning">Not recommended to implement cache-control at API level ... instead ensure API can return Cache-Control headers and supports expiration / validation models (Combine that with a cache server or CDN)</p>
              
              <p class="card-text bg-primary mt-5">Cache Invalidation</p>

              <p class="card-text bg-info">wiping a response from the cache because you know it isn't the correct version anymore (a lot is automated) (responses go stale, ETags get updated)</p>

              <p class="card-text bg-primary mt-5"><strong>Concurrency Strategies</strong></p>

              <p class="card-text bg-primary mb-5">Pessimistic concurrency (not possible in REST)  ... Resource Locked</p>
            
              <p class="card-text bg-primary"><strong>Optimistic concurrency (supported with Etags)</strong></p>

              <p class="card-text bg-info">Token is returned together with resource</p>

              <p class="card-text bg-info">The udpate can happen as long as the token is still valid</p>

              <p class="card-text bg-info">The Marvin.Cache Nuget package handles this stuff for us</p>

              <p class="card-text bg-info">use ETags as tokens/validators for an optimistic concurrency strategy</p>

              <p class="card-text bg-info">Send as If-Match header value</p>

              <p class="card-text bg-info">on mismatch, 412 Precondition Failed will be returned</p>
            
              <img src="img/apiCacheController.PNG" alt="dotNetCore cache controller example" class="card-img img-fluid mt-5">
              
              <img src="img/apiCacheController2.PNG" alt="dotNetCore cache controller example2" class="card-img img-fluid">

              <img src="img/apiCacheController3.PNG" alt="dotNetCore cache controller example3" class="card-img img-fluid">

              <img src="img/apiCacheController4.PNG" alt="dotNetCore cache controller example4" class="card-img img-fluid mb-5">
            
            </div>
        </div>
      </div>


      <div class="card">
        <div class="card-header">
          <h5>
            <a href="#collapse15" data-parent="#accordion" data-toggle="collapse">
              Summary
            </a>
          </h5>
        </div>

        <div id="collapse15" class="collapse">
          <div class="card-body bg-secondary">
           
            <p class="card-text bg-primary">Map (using IMapper) between Entities (classes) and Dtos (Model folder (what we return from our controllers))</p>

            <ul class="list-group">
              <p class="list-group-item-header">All fields should be updated as the Result of a put request</p>
              <li class="list-group-item list-group-item-success">fields not passed ... should be sets to default values</li>

              <li class="list-group-item list-group-item-success">200 for OK or 204 for No Content</li>
              <li class="list-group-item list-group-item-success">Not safe BUT idempotent</li>
            </ul>

            <ul class="list-group">
                <p class="list-group-item-header">PATCH for partial updates</p>
                <li class="list-group-item list-group-item-success">JSON Patch standard</li>
  
                <li class="list-group-item list-group-item-success">validate the patched DTO</li>
                <li class="list-group-item list-group-item-success">200 for OK or 204 for No Content</li>
                <li class="list-group-item list-group-item-success">Not Safe</li>
                <li class="list-group-item list-group-item-success">Not Idempotent</li>
              </ul>

              <p class="card-text bg-primary mb-5">validation: to minimize code duplication ... we can work with abstract base classes and mark common properties with virtual to allow for their own implementation</p>

              <p class="card-text bg-primary"><strong>Vendor-specific Media Types</strong></p>

              <p class="card-text bg-info mb-5">application/vnd.marvin.hateoas+json</p>

              <p class="card-text bg-primary">need to register / set-up valid OutputFormatters in startup.cs</p>

              
              <p class="card-text bg-primary">there should be only one suffix per media type, and only officially registered suffixes should be used</p>
              
              <p class="card-text bg-primary">always provide a default representation that will be returned when no semantic information is passed through (eg: application/json)</p>
              <p class="card-text bg-info">HATEOAS (tells User what they can do with our API)</p>

              <p class="card-text bg-info">HATEOS links should be return only when the correct media type is requested</p>
              
              <p class="card-text bg-info">(Hypermedia as the Application State)</p>

              <p class="card-text bg-info">helps with evolvability and self descriptiveness</p>

              <p class="card-text bg-info">if an API fails @ HATEOAS ... then a user of the API must know more than they should ... if an API fails @ HATEOAS ... the API cannot evolve separately of consuming applications</p>

              <p class="card-text bg-primary mt-5">Adapting to change:</p>

              <p class="card-text bg-info">HATEOAS for changes to functionality and business rules</p>

              <p class="card-text bg-info mb-5">Versioned media types (until code on demand feasible)</p>

              <p class="card-text bg-primary">creating a Dto (to return from requests)</p>

              <p class="card-text bg-info">1) create a Model class (dto)</p>

              <p class="card-text bg-info">2) add a Mapping profile (or just a CreateMap () in already existing Mapping Profile)</p>

              
              <p class="card-text bg-info">Advanced content negotation</p>

              <p class="card-text bg-info">Caching and concurrency</p>

              <p class="card-text bg-warning">Not recommended to implement cache-control at API level ... instead ensure API can return Cache-Control headers and supports expiration / validation models (Combine that with a cache server or CDN)</p>

              <p class="card-text bg-info">Paging, sorting, data shaping</p>
            
          </div>
        </div>
      </div>


    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
  </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
    integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous">
  </script>

</body>

</html>